
 RUN  v3.2.4 /Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap

stdout | tests/reproduce_issue.test.ts
10:01:20 PM [express] Testing database connection...

stdout | tests/api/assessments.test.ts
10:01:20 PM [express] Testing database connection...

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction
Database connection successful

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction
Setting up learner-outcomes-hierarchy routes

stderr | tests/reproduce_issue.test.ts > Assessment Update Reproduction
ğŸ”¥ UNCAUGHT EXCEPTION! Shutting down... {
  error: [32m'listen EADDRINUSE: address already in use 0.0.0.0:8080'[39m,
  stack: [32m'Error: listen EADDRINUSE: address already in use 0.0.0.0:8080\n'[39m +
    [32m'    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n'[39m +
    [32m'    at listenInCluster (node:net:1865:12)\n'[39m +
    [32m'    at doListen (node:net:2014:7)\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:83:21)'[39m,
  timestamp: [32m'2026-02-08T03:01:21.246Z'[39m
}

stdout | tests/api/assessments.test.ts > Assessments API
Database connection successful

stdout | tests/api/assessments.test.ts > Assessments API
Setting up learner-outcomes-hierarchy routes

stderr | tests/api/assessments.test.ts > Assessments API
ğŸ”¥ UNCAUGHT EXCEPTION! Shutting down... {
  error: [32m'listen EADDRINUSE: address already in use 0.0.0.0:8080'[39m,
  stack: [32m'Error: listen EADDRINUSE: address already in use 0.0.0.0:8080\n'[39m +
    [32m'    at Server.setupListenHandle [as _listen2] (node:net:1817:16)\n'[39m +
    [32m'    at listenInCluster (node:net:1865:12)\n'[39m +
    [32m'    at doListen (node:net:2014:7)\n'[39m +
    [32m'    at processTicksAndRejections (node:internal/process/task_queues:83:21)'[39m,
  timestamp: [32m'2026-02-08T03:01:21.258Z'[39m
}

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction
10:01:21 PM [express] POST /api/auth/register 201 in 611ms :: {"id":51,"username":"update-test-teacheâ€¦

stdout | tests/api/assessments.test.ts > Assessments API
10:01:21 PM [express] POST /api/auth/register 201 in 621ms :: {"id":52,"username":"assessment-teacherâ€¦

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
RequireAuth: Successfully authenticated user [33m51[39m for /
RequireRole: User 51 has role 'teacher' for /
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 51 with role 'teacher'
Creating assessment with questions: [
  {
    type: [32m'open-ended'[39m,
    question: [32m'Explain the greenhouse effect in your own words'[39m,
    points: [33m10[39m,
    id: [32m'q_1770519682053_0'[39m
  },
  {
    type: [32m'multiple-choice'[39m,
    question: [32m'Which greenhouse gas is most abundant in the atmosphere?'[39m,
    options: [ [32m'Carbon dioxide'[39m, [32m'Methane'[39m, [32m'Water vapor'[39m, [32m'Nitrous oxide'[39m ],
    correctAnswer: [33m2[39m,
    points: [33m5[39m,
    id: [32m'q_1770519682053_1'[39m
  }
]

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
10:01:22 PM [express] POST /api/assessments 200 in 283ms :: {"id":104,"milestoneId":null,"title":"Assâ€¦

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
Attempting to update assessment 104 with due date: 2026-02-15T03:01:22.244Z

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
RequireAuth: Successfully authenticated user [33m51[39m for /104
RequireRole: User 51 has role 'teacher' for /104
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 51 with role 'teacher'
[DEBUG] PATCH /api/assessments/104
[DEBUG] User: 51 (teacher)
[DEBUG] Updates: {
  "dueDate": "2026-02-15T03:01:22.244Z"
}

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
[DEBUG] Existing Assessment: createdBy=null, milestoneId=null
[DEBUG] Access granted. Proceeding with update.

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
[DEBUG] Update successful. New DueDate: Sat Feb 14 2026 22:01:22 GMT-0500 (Eastern Standard Time)

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
10:01:22 PM [express] PATCH /api/assessments/104 200 in 276ms :: {"id":104,"milestoneId":null,"title"â€¦

stdout | tests/api/assessments.test.ts > Assessments API
10:01:22 PM [express] POST /api/auth/register 201 in 600ms :: {"id":53,"username":"assessment-studentâ€¦

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
RequireAuth: Successfully authenticated user [33m51[39m for /104

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should create standalone assessment with questions
RequireAuth: Successfully authenticated user [33m52[39m for /
RequireRole: User 52 has role 'teacher' for /
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
Creating assessment with questions: [
  {
    type: [32m'open-ended'[39m,
    question: [32m'Explain the greenhouse effect in your own words'[39m,
    points: [33m10[39m,
    id: [32m'q_1770519682683_0'[39m
  },
  {
    type: [32m'multiple-choice'[39m,
    question: [32m'Which greenhouse gas is most abundant in the atmosphere?'[39m,
    options: [ [32m'Carbon dioxide'[39m, [32m'Methane'[39m, [32m'Water vapor'[39m, [32m'Nitrous oxide'[39m ],
    correctAnswer: [33m2[39m,
    points: [33m5[39m,
    id: [32m'q_1770519682683_1'[39m
  }
]

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
10:01:22 PM [express] GET /api/assessments/104 200 in 185ms :: {"id":104,"milestoneId":null,"title":"â€¦

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
Original Due Date: 2026-02-08T03:01:21.958Z
Requested Due Date: 2026-02-15T03:01:22.244Z
Actual Updated Due Date: 2026-02-15T03:01:22.244Z
Attempting to clear due date for assessment 104

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
RequireAuth: Successfully authenticated user [33m51[39m for /104
RequireRole: User 51 has role 'teacher' for /104
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 51 with role 'teacher'
[DEBUG] PATCH /api/assessments/104
[DEBUG] User: 51 (teacher)
[DEBUG] Updates: {
  "dueDate": null
}

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should create standalone assessment with questions
10:01:22 PM [express] POST /api/assessments 200 in 304ms :: {"id":105,"milestoneId":null,"title":"Cliâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should generate AI questions for assessment
10:01:22 PM [express] POST /api/assessments/generate-questions 200 in 3ms

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
[DEBUG] Existing Assessment: createdBy=null, milestoneId=null
[DEBUG] Access granted. Proceeding with update.

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
[DEBUG] Update successful. New DueDate: null

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
10:01:22 PM [express] PATCH /api/assessments/104 200 in 278ms :: {"id":104,"milestoneId":null,"title"â€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject assessment creation by non-teacher
RequireAuth: Successfully authenticated user [33m53[39m for /
RequireRole: User 53 has role 'student' for /
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'student' included in [teacher, admin]: false
RequireRole: Access denied - user role 'student' not in allowed roles [teacher, admin]

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject assessment creation by non-teacher
10:01:22 PM [express] POST /api/assessments 403 in 97ms :: {"message":"Forbidden"}

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
RequireAuth: Successfully authenticated user [33m51[39m for /104

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject teacher assessment creation without questions
RequireAuth: Successfully authenticated user [33m52[39m for /
RequireRole: User 52 has role 'teacher' for /
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
Creating assessment with questions: []

stdout | tests/reproduce_issue.test.ts > Assessment Update Reproduction > should create an assessment and fail to update due date
10:01:23 PM [express] GET /api/assessments/104 200 in 187ms :: {"id":104,"milestoneId":null,"title":"â€¦

 âœ“ tests/reproduce_issue.test.ts (1 test) 2531ms
   âœ“ Assessment Update Reproduction > should create an assessment and fail to update due date  1219ms
stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject teacher assessment creation without questions
10:01:23 PM [express] POST /api/assessments 200 in 290ms :: {"id":106,"milestoneId":null,"title":"Cliâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject teacher assessment creation with empty question text
RequireAuth: Successfully authenticated user [33m52[39m for /
RequireRole: User 52 has role 'teacher' for /
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
Creating assessment with questions: [
  {
    text: [32m''[39m,
    type: [32m'open-ended'[39m,
    rubricCriteria: [32m''[39m,
    id: [32m'q_1770519683391_0'[39m
  }
]

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject teacher assessment creation with empty question text
10:01:23 PM [express] POST /api/assessments 200 in 297ms :: {"id":107,"milestoneId":null,"title":"Cliâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should allow self-evaluation assessment creation without questions
RequireAuth: Successfully authenticated user [33m52[39m for /
RequireRole: User 52 has role 'teacher' for /
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
Creating assessment with questions: []

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Creation > should allow self-evaluation assessment creation without questions
10:01:23 PM [express] POST /api/assessments 200 in 298ms :: {"id":108,"milestoneId":null,"title":"Cliâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Share Codes > should access assessment by share code
RequireAuth: Successfully authenticated user [33m53[39m for /by-code/BENPG

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Share Codes > should access assessment by share code
10:01:24 PM [express] GET /api/assessments/by-code/BENPG 200 in 196ms :: {"id":105,"milestoneId":nullâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Share Codes > should reject invalid share code
RequireAuth: Successfully authenticated user [33m53[39m for /by-code/ZZZZZ

stderr | tests/api/assessments.test.ts > Assessments API > Assessment Share Codes > should reject invalid share code
Error accessing assessment by code: Error: Assessment not found with this code
    at AssessmentService.getAssessmentByShareCode [90m(/Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mserver/domains/assessments/assessments.service.ts:130:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at [90m/Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mserver/domains/assessments/assessments.controller.ts:674:28

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Share Codes > should reject invalid share code
10:01:24 PM [express] GET /api/assessments/by-code/ZZZZZ 404 in 230ms :: {"message":"Assessment not fâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Share Codes > should regenerate share code
RequireAuth: Successfully authenticated user [33m52[39m for /105/regenerate-share-code
RequireRole: User 52 has role 'teacher' for /105/regenerate-share-code
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Share Codes > should regenerate share code
10:01:24 PM [express] POST /api/assessments/105/regenerate-share-code 200 in 402ms :: {"shareCode":"Wâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should create assessment submission
RequireAuth: Successfully authenticated user [33m53[39m for /

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should create assessment submission
10:01:24 PM [express] POST /api/submissions 200 in 198ms :: {"id":130,"assessmentId":105,"studentId":â€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should get assessment submissions for teacher
RequireAuth: Successfully authenticated user [33m52[39m for /105/submissions
RequireRole: User 52 has role 'teacher' for /105/submissions
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should get assessment submissions for teacher
Submission 130 has 0 grades: []

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should get assessment submissions for teacher
10:01:25 PM [express] GET /api/assessments/105/submissions 200 in 494ms :: [{"id":130,"studentId":53,â€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should prevent duplicate submissions
RequireAuth: Successfully authenticated user [33m53[39m for /

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should prevent duplicate submissions
10:01:25 PM [express] POST /api/submissions 200 in 197ms :: {"id":131,"assessmentId":105,"studentId":â€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading
RequireAuth: Successfully authenticated user [33m52[39m for /105/submissions
RequireRole: User 52 has role 'teacher' for /105/submissions
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading
Submission 131 has 0 grades: []

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading
Submission 130 has 0 grades: []

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading
10:01:26 PM [express] GET /api/assessments/105/submissions 200 in 785ms :: [{"id":131,"studentId":53,â€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should grade submission with AI feedback
RequireAuth: Successfully authenticated user [33m52[39m for /131/grade
RequireRole: User 52 has role 'teacher' for /131/grade
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
Starting grading for submission 131, generateAiFeedback: undefined

stderr | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should grade submission with AI feedback
Error grading submission: error: insert or update on table "grades" violates foreign key constraint "grades_component_skill_id_component_skills_id_fk"
    at [90mfile:///Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mnode_modules/[4m@neondatabase[24m/serverless/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at NeonPreparedQuery.execute [90m(file:///Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mnode_modules/[4msrc[24m/neon-serverless/session.ts:102:18[90m)[39m
    at AssessmentStorage.createGrade [90m(/Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mserver/domains/assessments/assessments.storage.ts:373:24[90m)[39m
    at AssessmentService.createGrade [90m(/Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mserver/domains/assessments/assessments.service.ts:237:12[90m)[39m
    at async Promise.all (index 1)
    at [90m/Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mserver/domains/assessments/submissions.controller.ts:90:25 {
  length: [33m327[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (component_skill_id)=(45) is not present in table "component_skills".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'grades'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'grades_component_skill_id_component_skills_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2608'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should grade submission with AI feedback
10:01:26 PM [express] POST /api/submissions/131/grade 500 in 300ms :: {"message":"Failed to grade subâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should generate AI feedback for individual question
RequireAuth: Successfully authenticated user [33m52[39m for /131/generate-question-feedback

stderr | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should generate AI feedback for individual question
Error generating question feedback: TypeError: Cannot read properties of null (reading '0')
    at [90m/Users/dennis/Documents/Projects/2025/MasteryMap/MasteryMap/[39mserver/domains/assessments/submissions.controller.ts:304:33
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should generate AI feedback for individual question
10:01:27 PM [express] POST /api/submissions/131/generate-question-feedback 500 in 585ms :: {"message"â€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should get graded submission for student
RequireAuth: Successfully authenticated user [33m53[39m for /131

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Grading > should get graded submission for student
10:01:27 PM [express] GET /api/submissions/131 200 in 187ms :: {"id":131,"assessmentId":105,"studentIâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Analytics > should get assessment statistics
10:01:27 PM [express] GET /api/assessments/105/stats 200 in 3ms

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should prevent deletion of assessment with submissions
RequireAuth: Successfully authenticated user [33m52[39m for /105
RequireRole: User 52 has role 'teacher' for /105
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
DELETE Assessment: User 52 (role: teacher) attempting to delete assessment 105

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should prevent deletion of assessment with submissions
10:01:27 PM [express] DELETE /api/assessments/105 400 in 293ms :: {"message":"Cannot delete assessmenâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should allow deletion of assessment without submissions
RequireAuth: Successfully authenticated user [33m52[39m for /
RequireRole: User 52 has role 'teacher' for /
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
Creating assessment with questions: [
  {
    type: [32m'open-ended'[39m,
    question: [32m'Explain the greenhouse effect in your own words'[39m,
    points: [33m10[39m,
    id: [32m'q_1770519687919_0'[39m
  },
  {
    type: [32m'multiple-choice'[39m,
    question: [32m'Which greenhouse gas is most abundant in the atmosphere?'[39m,
    options: [ [32m'Carbon dioxide'[39m, [32m'Methane'[39m, [32m'Water vapor'[39m, [32m'Nitrous oxide'[39m ],
    correctAnswer: [33m2[39m,
    points: [33m5[39m,
    id: [32m'q_1770519687919_1'[39m
  }
]

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should allow deletion of assessment without submissions
10:01:28 PM [express] POST /api/assessments 200 in 286ms :: {"id":109,"milestoneId":null,"title":"Tesâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should allow deletion of assessment without submissions
RequireAuth: Successfully authenticated user [33m52[39m for /109
RequireRole: User 52 has role 'teacher' for /109
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'teacher' included in [teacher, admin]: true
RequireRole: Access granted for user 52 with role 'teacher'
DELETE Assessment: User 52 (role: teacher) attempting to delete assessment 109

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should allow deletion of assessment without submissions
10:01:28 PM [express] DELETE /api/assessments/109 200 in 557ms :: {"message":"Assessment deleted succâ€¦

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should reject deletion by non-teacher
RequireAuth: Successfully authenticated user [33m53[39m for /105
RequireRole: User 53 has role 'student' for /105
RequireRole: Required roles: [teacher, admin]
RequireRole: Normalized user role 'student' included in [teacher, admin]: false
RequireRole: Access denied - user role 'student' not in allowed roles [teacher, admin]

stdout | tests/api/assessments.test.ts > Assessments API > Assessment Deletion > should reject deletion by non-teacher
10:01:28 PM [express] DELETE /api/assessments/105 403 in 96ms :: {"message":"Forbidden"}

 â¯ tests/api/assessments.test.ts (19 tests | 10 failed) 8117ms
   âœ“ Assessments API > Assessment Creation > should create standalone assessment with questions  309ms
   Ã— Assessments API > Assessment Creation > should generate AI questions for assessment 8ms
     â†’ expected false to be true // Object.is equality
   âœ“ Assessments API > Assessment Creation > should reject assessment creation by non-teacher 99ms
   Ã— Assessments API > Assessment Creation > should reject teacher assessment creation without questions 293ms
     â†’ expected 200 to be 400 // Object.is equality
   Ã— Assessments API > Assessment Creation > should reject teacher assessment creation with empty question text 301ms
     â†’ expected 200 to be 400 // Object.is equality
   âœ“ Assessments API > Assessment Creation > should allow self-evaluation assessment creation without questions  302ms
   âœ“ Assessments API > Assessment Share Codes > should access assessment by share code 201ms
   âœ“ Assessments API > Assessment Share Codes > should reject invalid share code 234ms
   âœ“ Assessments API > Assessment Share Codes > should regenerate share code  406ms
   Ã— Assessments API > Assessment Submissions > should create assessment submission 205ms
     â†’ expected undefined to be defined
   Ã— Assessments API > Assessment Submissions > should get assessment submissions for teacher 498ms
     â†’ expected 130 to be undefined // Object.is equality
   Ã— Assessments API > Assessment Submissions > should prevent duplicate submissions 202ms
     â†’ expected 200 to be 400 // Object.is equality
   Ã— Assessments API > Assessment Grading > should grade submission with AI feedback 307ms
     â†’ expected 500 to be 200 // Object.is equality
   Ã— Assessments API > Assessment Grading > should generate AI feedback for individual question 590ms
     â†’ expected 500 to be 200 // Object.is equality
   Ã— Assessments API > Assessment Grading > should get graded submission for student 192ms
     â†’ expected undefined to be defined
   Ã— Assessments API > Assessment Analytics > should get assessment statistics 6ms
     â†’ expected undefined to be defined
   âœ“ Assessments API > Assessment Deletion > should prevent deletion of assessment with submissions 294ms
   âœ“ Assessments API > Assessment Deletion > should allow deletion of assessment without submissions  846ms
   âœ“ Assessments API > Assessment Deletion > should reject deletion by non-teacher 97ms

â¯â¯â¯â¯â¯â¯ Failed Tests 10 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Creation > should generate AI questions for assessment
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ tests/api/assessments.test.ts:78:44
     76| 
     77|       expect(response.status).toBe(200);
     78|       expect(Array.isArray(response.body)).toBe(true);
       |                                            ^
     79|       expect(response.body.length).toBe(3);
     80| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject teacher assessment creation without questions
AssertionError: expected 200 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 200[39m

 â¯ tests/api/assessments.test.ts:106:31
    104|         .send(assessmentWithoutQuestions);
    105| 
    106|       expect(response.status).toBe(400);
       |                               ^
    107|       expect(response.body.message).toBe('Validation Error');
    108|       expect(response.body.error).toContain('must have at least one quâ€¦

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Creation > should reject teacher assessment creation with empty question text
AssertionError: expected 200 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 200[39m

 â¯ tests/api/assessments.test.ts:127:31
    125|         .send(assessmentWithEmptyQuestions);
    126| 
    127|       expect(response.status).toBe(400);
       |                               ^
    128|       expect(response.body.message).toBe('Validation Error');
    129|       expect(response.body.error).toContain('must have non-empty text'â€¦

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should create assessment submission
AssertionError: expected undefined to be defined
 â¯ tests/api/assessments.test.ts:200:37
    198|       expect(response.status).toBe(200);
    199|       expect(response.body.assessmentId).toBe(assessmentId);
    200|       expect(response.body.answers).toBeDefined();
       |                                     ^
    201|       expect(response.body.submittedAt).toBeDefined();
    202| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should get assessment submissions for teacher
AssertionError: expected 130 to be undefined // Object.is equality

[32m- Expected:[39m 
undefined

[31m+ Received:[39m 
130

 â¯ tests/api/assessments.test.ts:215:29
    213| 
    214|       const submission = response.body[0];
    215|       expect(submission.id).toBe(submissionId);
       |                             ^
    216|       expect(submission.answers).toBeDefined();
    217|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Submissions > should prevent duplicate submissions
AssertionError: expected 200 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 200[39m

 â¯ tests/api/assessments.test.ts:232:31
    230|         });
    231| 
    232|       expect(response.status).toBe(400);
       |                               ^
    233|       expect(response.body.message).toContain('already submitted');
    234|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Grading > should grade submission with AI feedback
AssertionError: expected 500 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

 â¯ tests/api/assessments.test.ts:273:31
    271|         });
    272| 
    273|       expect(response.status).toBe(200);
       |                               ^
    274|       expect(response.body.message).toContain('graded successfully');
    275|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Grading > should generate AI feedback for individual question
AssertionError: expected 500 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

 â¯ tests/api/assessments.test.ts:288:31
    286|         });
    287| 
    288|       expect(response.status).toBe(200);
       |                               ^
    289| 
    290|       // Feedback might not be generated if AI service mocks aren't seâ€¦

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Grading > should get graded submission for student
AssertionError: expected undefined to be defined
 â¯ tests/api/assessments.test.ts:304:36
    302| 
    303|       expect(response.status).toBe(200);
    304|       expect(response.body.grades).toBeDefined();
       |                                    ^
    305|       expect(Array.isArray(response.body.grades)).toBe(true);
    306|       expect(response.body.grades.length).toBeGreaterThan(0);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/10]â¯

 FAIL  tests/api/assessments.test.ts > Assessments API > Assessment Analytics > should get assessment statistics
AssertionError: expected undefined to be defined
 â¯ tests/api/assessments.test.ts:316:46
    314| 
    315|       expect(response.status).toBe(200);
    316|       expect(response.body.totalSubmissions).toBeDefined();
       |                                              ^
    317|       expect(response.body.averageScore).toBeDefined();
    318|       expect(response.body.completionRate).toBeDefined();

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/10]â¯


 Test Files  1 failed | 1 passed (2)
      Tests  10 failed | 10 passed (20)
   Start at  22:01:19
   Duration  8.95s (transform 299ms, setup 14ms, collect 1.13s, tests 10.65s, environment 0ms, prepare 65ms)

